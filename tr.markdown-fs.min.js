// Renan LAVAREC - Ti-R - MIT License
if(TR==undefined){var TR={}}TR.MarkdownFSGlobal=new function(){let a=this;a.Debug=false;a.bM=function(){if(a.Debug){console.log("[Markdown] ",arguments)}};a.aZ="    ";const T="<blockquote>";const B="</blockquote>\n";const I=/(\S*)\s?(\S*)/g;const V=/[<>`&]/g;a.bz=/!\[(.*?)\]\((.*?)\)/g;a.by=/\[(.*)\](.*)/g;a.aT=/<?(https|http|ftp):\/\/([^\s<)]*?)($|[>\s<])/g;const J=/^\s*\|(.*)\|\s*$/;const i=/^(\s*)[-*+](\s+)(.*)/;const j=/^(\s*)(\d+)[\.\)](\s+)(.*)/;const D="";const C={"<":"&lt;",">":"&gt;","&":"&amp;","*":"&#42;",_:"&#95;","-":"&#45;","`":"&#96;"};a.az=function X(q){return q.replace(V,function(Y){return C[Y]})};const O={c:"&copy;",C:"&copy;",r:"&reg;",R:"&reg;",p:"&sect;",P:"&sect;",tm:"&trade;",TM:"&trade;"};let K=0;a.bb=function(q){q.x=q.d.length;q.f=0;q.J=0;q.I=0;if(q.x!=0){q.H=0;if(q.x>2){if((q.d[q.x-2]=="\\")&&(q.d[q.x-3]!="\\")){q.H=2}if((q.d[q.x-2]==" ")&&(q.d[q.x-3]==" ")){q.H=3}if((q.d[q.x-2]=="\\")&&(q.d[q.x-3]=="\\")){q.H=-1}}for(let s=0;s<q.x;s++){q.r=q.d.charCodeAt(s);K=a.aa[q.r];if(K!=undefined){q.f+=K;if(K>0){++q.J}if(K==0){if(q.f>0){q.I=((q.f/4)|0)+1}q.af=s;return}}else{q.af=s;return}}q.af=0;q.r=0;K=0}else{q.af=0;q.r=13}};a.bD=function t(q,Z){Z=Z.replace(/\`+(.*?)\`+/g,function(ab,aa){q.aR.push("<code>"+a.az(aa)+"</code>");return"¤cod¤"});Z=Z.replace(/\\([<_*-])/g,function(ab,aa){return C[aa]});Z=Z.replace(/\s<\s/g,function(){return C["<"]});Z=Z.replace(/\`{4}(.*?)\`{4}/g,function(ab,aa){return"<code>"+a.az(aa)+"</code>"});function Y(aa){let k={};let aD="";k.Y="";k.V="";if(aa&&aa.length>2){try{aa=aa.replaceAll(";}","}").replaceAll(";",'","').replaceAll(":",'":"').replaceAll("{",'{"').replaceAll("}",'"}');tObject=JSON.parse(aa);if(typeof tObject["text-align"]!="undefined"){aD=";text-align:"+tObject["text-align"];k.V='style="display:inline-block;width:100%'+aD+'"';delete tObject["text-align"]}aa=JSON.stringify(tObject).replaceAll(",",";").replaceAll('"',"");k.Y=' style="'+aa.substring(1,aa.length-1)+'"'}catch(ab){console.log("Parsing css to javascript object failed",aa)}}return k}Z=Z.replace(/!(.)?\[([^\[]*?)\]\((.*?)\)({(.*?)})?/g,function(ai,ag,ab,ah,aa){ah=ah.replace(I,function(ak,am,aj){return am});const af=Y(aa);if(ag==undefined){if(af.V!=""){q.ap.push("<span "+af.V+'><img src="'+ah+'" alt="'+ab+'"'+af.Y+"></span>")}else{q.ap.push('<img src="'+ah+'" alt="'+ab+'"'+af.Y+">")}return"¤img¤"}else{if(ag=="v"){if(ab==D){ab="Your browser does not support the HTML5 Video element."}q.aP.push("<span "+af.V+'><video controls="controls" src="'+ah+'"'+af.Y+">"+ab+"</video></span>");return"¤vid¤"}else{if(ag=="f"){if(q.mOptions.iFrameAllowed){q.aq.push("<span "+af.V+'><iframe type="text/html" title="'+ab+'"'+af.Y+' src="'+ah+'?enablejsapi=1" frameborder="0" allowfullscreen sandbox="allow-scripts allow-same-origin allow-presentation"></iframe></span>')}else{q.aq.push("")}return"¤ifr¤"}}}});Z=Z.replace(/\[([^\[]*?)\]\((.*?)\)/g,function(af,aa,ab){let v=D;if(ab&&ab.length){if(ab[0]!="#"){v=' rel="nofollow"'}let w=ab.search(/\s/);if(w!=-1){tIndex=w+1+ab.substring(w+1).search(/\S/);const ah=ab[tIndex];if(ah!=")"){if(ah=='"'||ah=="'"){const ag=tIndex+1+ab.substring(tIndex+1).search(/["']/);v+=" title="+ab.substring(tIndex+1,ag)}else{v+=' title="'+ab.substring(tIndex,ab.length)+'"'}}ab=ab.substring(0,w)}}q.aQ.push('<a href="'+ab+'"'+v+">"+aa+"</a>");return"¤url¤"});Z=Z.replace(a.aT,function(ag,aa,af,ab){let aC=aa+"://"+af;if(ab==">"){ab=D}let v=D;if(af&&af.length&&af[0]!="#"){v=' rel="nofollow"'}return'<a href="'+aC+'"'+v+">"+aC+" </a>"+ab});Z=Z.replace(/[_\*][_\*](.*?)[_\*][_\*]/g,function(ab,aa){return"<strong>"+aa+"</strong>"});Z=Z.replace(/[_\*](.*?)[_\*]/g,function(ab,aa){return"<em>"+aa+"</em>"});Z=Z.replace(/\~~(.*?)\~~/g,function(ab,aa){return"<del>"+aa+"</del>"});Z=Z.replace(/\(([cCrRpP]|tm|TM)\)/g,function(ab,aa){return O[aa]});Z=Z.replace(/\+-/g,function(){return"&plusmn;"});Z=Z.replace(/(->|<-|---|--)/g,function(ab,aa){if(aa=="<-"){return"&larr;"}else{if(aa=="->"){return"&rarr;"}else{if(aa.length==3){return"&mdash;"}else{return"&ndash;"}}}});Z=Z.replace(/\[([x| ])\]/g,function(ab,aa){let aK="checked ";if(aa==" "){aK=D}return'<input type="checkbox" '+aK+"disabled>"});Z=Z.replace(/(!?)\[(.*?)\]\s?\[(.*?)\]/g,function(af,aa,ag,ab){if(ab.length==0){ab=ag}ab=ab.toLowerCase();if(q.W[ab]==undefined){return aa+"["+ag+"]["+ab+"]"}let S=q.W[ab];if(aa=="!"){return'<img src="'+S.bt+'" alt="'+S.title+'">'}let v=D;let g=S.bt;if(S.title!=D){v+=' title="'+S.title+'"'}return'<a href="'+g+'"'+v+">"+ag+"</a>"});Z=Z.replaceAll("\n","");let bo=0;let bl=0;let bk=0;let p=0;let n=Z.indexOf("¤");let o="";while(n>-1){let F=Z.substring(n+1,n+4);o+=Z.substring(p,n);p=n;if(F=="cod"){o+=q.aR[bo++];p+=5}else{if(F=="pre"){o+=q.ar[bl++];p+=5}else{if(F=="url"){o+=q.aQ[bk++];p+=5}}}n=Z.indexOf("¤",n+5)}o+=Z.substring(p,Z.length);Z=o;let bm=0;let bj=0;let bn=0;p=0;n=Z.indexOf("¤");o="";while(n>-1){let F=Z.substring(n+1,n+4);o+=Z.substring(p,n);p=n;if(F=="img"){o+=q.ap[bm++];p+=5}else{if(F=="vid"){o+=q.aP[bj++];p+=5}else{if(F=="ifr"){o+=q.aq[bn++];p+=5}}}n=Z.indexOf("¤",n+5)}o+=Z.substring(p,Z.length);Z=o;return Z};a.bH=function(q){if(q.B>0){do{if(q.ae!=""){q.l+="<p>";a.j(q,"</p>"+B)}else{a.j(q,B)}}while(--q.B>0)}};a.bd=function P(q){if(q.u){q.u=0;a.j(q,"</tbody></table>",false)}};a.j=function m(q,Z,Y){q.l+=q.ae;if(Z!=undefined){q.l+=Z}q.ae=""};a.bI=function(q,Y){if(q.E){q.ae+="\n"}};a.be=function x(q,Y){let M=0;do{let c=(/^\s*\>\s*(.*)/).exec(Y.d);if(c==null){break}else{Y.d=c[1];++M}}while(1);if(M>0){q.ai=true;if((M-q.B)>0){for(;q.B<M;++q.B){a.j(q,T)}}else{if((q.B-M)>0){for(;q.B>M;--q.B){a.j(q,B)}}}a.bb(Y);q.aN=true;return false}if(q.ai){a.aA(q,Y)}};a.aA=function u(q,Y){a.bc(q,Y);a.bH(q)};a.ah=function z(q,Y){if(Y.d!=D){let c=(/(```|~~~)(.*)/).exec(Y.d);if(c!=null){if(!q.E){q.E=true;a.j(q);q.aI=c[2]}else{q.E=false;q.ae=q.mOptions.FilterCodes.call(a,q.ae,q.aI);q.ar.push(q.ae);q.ae="¤pre¤\n";a.j(q)}return true}}return false};a.ag=function H(q,Y){if((Y.f-q.h)>=4){let bh=q.h+4;Y.d=Y.d.replace(/\t/g,a.aZ);if(!q.Q){q.Q=true;a.j(q)}q.ae+=Y.d.slice(bh,Y.d.length)+"\n";return true}a.bc(q,Y);return false};a.bc=function W(q,Y){if(q.Q){q.Q=false;q.ae=q.mOptions.FilterCodes.call(a,q.ae,D);q.ar.push(q.ae);q.ae="¤pre¤\n";a.j(q)}};a.aW=function E(q,Y){let c=(/^[=-]{3}[=-]+/).test(Y.d);if(c){if(Y.d[0]=="="){q.l+="<H1>";a.j(q,"</H1>\n")}else{if(Y.d[0]=="-"){q.l+="<H2>";a.j(q,"</H2>\n")}}return true}return false};a.aX=function l(q,Y){let c=(/^\s*(#+)\s+([^#]*)(#*)/).exec(Y.d);if(c!=null){c[2]=c[2].trim();if(!q.G&&(Y.f<q.h||(Y.f==0))){a.Z(q,Y.f)}let bp=c[1].length;let ac={};ac.ba=true;let bs=q.mOptions.FilterHeadingSections.call(q,bp,c[2],ac);q.aj=ac.ba;if(ac.ba==true){a.j(q,bs);q.bg=true}else{}return true}return false};a.aY=function d(q,Y){let c=J.exec(Y.d);if(c!=null){if(q.u==0){a.j(q,"<table><thead><tr>")}else{a.j(q,"<tr>")}let aJ=false;let aL=c[1].split("|");for(let y=0;y<aL.length;y++){let N=aL[y];N=N.trim();if(q.u==0){q.l+="<th>";q.ae+=N;a.j(q,"</th>")}else{if(q.u==1){N.replace(/^(:*)-+(:*)$/,function(ab,aa,Z){if(aa!=""){if(Z!=""){q.D[y]=0}else{q.D[y]=1}}else{if(Z!=""){q.D[y]=2}else{q.D[y]=3}}aJ=true});if(aJ){continue}}let k="";if(q.D[y]==0){k=' style="text-align:center;"'}else{if(q.D[y]==1){k=' style="text-align:left;"'}else{if(q.D[y]==2){k=' style="text-align:right;"'}}}q.l+="<td"+k+">";q.ae+=N;a.j(q,"</td>")}}if(q.u==0){q.l+="</tr></thead><tbody>";q.u=1}else{q.u=2;a.j(q,"</tr>")}q.T=a.aY;return true}a.bd(q);return false};a.bd=function P(q){if(q.u>0){q.u=0;a.j(q,"</tbody></table>",false)}};a.aw=function(q,Y){let c=i.exec(Y.d);if(c!=null){return true}return false};a.ax=function Q(q,Y){let c=i.exec(Y.d);if(c!=null){q.G=false;Y.f-=1;Y.f+=c[2].length;let U=false;if(Y.f>q.h){q.h=Y.f;if((q.h+1)>q.X){q.X=q.h+1}}else{if(Y.f<q.h){U=true;q.h=Y.f}}if(q.t[q.h]&2048||U){a.Z(q,Y.f)}if(q.t[q.h]==0){q.t[q.h]=32768;q.l+="<ul>\n"}else{q.ae+="</li>\n";a.j(q)}q.l+="<li>\n";q.l+=c[3];return true}return false};a.bE=function(q,Y){let c=j.exec(Y.d);if(c!=null){return true}return false};a.bF=function f(q,Y){let c=j.exec(Y.d);if(c!=null){q.G=false;let U=false;Y.f+=c[2].length;Y.f-=1;Y.f+=c[3].length;if(Y.f>q.h){q.h=Y.f;if((q.h+1)>q.X){q.X=q.h+1}}else{if(Y.f<q.h){U=true;q.h=Y.f}}if(q.t[q.h]&32768||U){a.Z(q,Y.h)}if(q.t[q.h]==0){q.t[q.h]=2048;q.l+="<ol start="+c[2]+">\n"}else{q.ae+="</li>\n";a.j(q)}q.l+="<li>\n";q.ae+=c[4];return true}return false};a.Z=function r(q,Y){if(!q.G){let ad=q.X;while(ad-->Y){if(q.t[ad]!=0){if(q.t[ad]&2048){a.j(q,"</li>\n</ol>\n")}else{a.j(q,"</li>\n</ul>\n")}q.t[ad]=0}}if(Y==0){q.G=true;q.h=0}}};a.bG=function G(q,Y){let c=(/\[(.*?)\]:\s+(.*)/).exec(Y.d);if(c!=null){if(c.length>2){const ab=c[2];let w=ab.search(/\s/);if(w!=-1){tIndex=w+1+ab.substring(w+1).search(/\S/);const aa=ab[tIndex];if(aa!=")"){if(aa=='"'||aa=="'"||aa=="("){const Z=tIndex+1+ab.substring(tIndex+1).search(/["')]/);q.W[c[1].toLowerCase()]={link:ab.substring(0,w),title:ab.substring(tIndex+1,Z)}}else{q.W[c[1].toLowerCase()]={link:ab.substring(0,w),title:ab.substring(tIndex,ab.length)}}return true}}}q.W[c[1].toLowerCase()]={link:c[2],title:D};tConvertURL=false;return true}return false};a.ay=function(q,Y){let c=(/^[\*-]\s[\*-]\s[\*-]/).exec(Y.d);if(c!=null){q.l+="<hr>";return true}c=(/^[\*_-]{3}/).exec(Y.d);if(c!=null){q.l+="<hr>";return true}return false};a.P=256;a.aa=new Array(a.P);a.m=new Array(a.P);a.ab=new Array(a.P);a.O=new Array(a.P);for(let s=a.P;s--;){a.aa[s]=0;a.m[s]=undefined;a.ab[s]=undefined;a.O[s]=undefined}function h(q){return q.charCodeAt(0)}a.aM=h(" ");a.am=h("*");a.ao=h("-");a.an=h("+");a.aB=h("0");a.aO=h("9");a.aa[h("\t")]=4;a.aa[h(" ")]=1;a.m[13]=a.bI;a.m[h("=")]=a.aW;a.m[a.ao]=[a.ay,a.aW,a.ax];a.m[h("_")]=a.ay;a.ab[h("~")]=a.ah;a.ab[h("`")]=a.ah;a.m[h("~")]=a.ah;a.m[h("`")]=a.ah;a.m[a.aM]=a.ag;a.m[h("#")]=a.aX;a.bf=h(">");a.m[a.bf]=a.be;a.m[h("|")]=a.aY;a.m[a.am]=[a.ay,a.ax];a.m[a.an]=a.ax;a.O[a.am]=a.aw;a.O[a.an]=a.aw;a.O[a.ao]=a.aw;let bu=a.aO;for(let ae=a.aB;ae<=bu;ae++){a.O[ae]=a.bE;a.m[ae]=a.bF}a.m[h("[")]=a.bG};TR.MarkdownFS=function(d){let a=this;a.mOptions={};a.mOptions.Timing=false;a.mOptions.iFrameAllowed=true;a.mOptions.FilterCodes=function(f,h){return"<pre>"+TR.MarkdownFSGlobal.az(f)+"</pre>"};a.mOptions.FilterHeadingSections=function(h,i,f){return"<H"+h+this.bC(i)+">"+i+"</H"+h+">\n"};a.aH=100;a.X=2;a.t=new Array(a.aH);if(d){let a=this;for(let key in d){a.mOptions[key]=d[key]}}};TR.MarkdownFS.prototype.bC=function(d){let e=TR.MarkdownFSGlobal;d=d.replace(e.bz,function(f,i,h){return e.q});d=d.replace(e.aT,function(){return e.q});if(d==e.q){return d}d=d.replace(e.by,function(h,f){return f});d=d.replace(/\\</g,function(){return"<"});d=d.replace(/\s/g,"-");return' id="'+d.toLowerCase()+'"'};TR.MarkdownFS.prototype.toHtml=function(d){let a=this;a.E=false;a.Q=false;a.aj=true;a.l="";a.T=null;a.bJ=false;a.ae="";a.aR=[];a.ar=[];a.aQ=[];a.ap=[];a.aP=[];a.aq=[];a.G=true;for(let aS=a.aH;aS--;){a.t[aS]=0}a.ai=false;a.u=0;a.h=0;a.B=0;a.bg=false;a.D={};a.aI="";a.W={};let aE;if(a.mOptions.Timing){aE=performance.now()}let aG=d.split("\n");let e=TR.MarkdownFSGlobal;let aF=0;let bi=aG.length;let al=false;let b={};let R=0;let L=0;let A;let bL;let bK=false;for(let as=0;as<bi;as++){b.d=aG[as];e.bb(b);if(a.aj){if(a.Q){if(e.ag(a,b)){continue}}if(!a.E){if(b.r!=13){if(b.r==e.bf){a.T=e.be}if(e.ag(a,b)){continue}if(b.r==e.am||b.r==e.ao||b.r==e.an||(b.r>=e.aB&&b.r<=e.aO)){if(b.d.charCodeAt(b.af+1)==e.aM){b.f+=2}}if(!a.G&&((b.f<a.h)&&(b.f!=(a.h-2))||(b.f==0))){e.Z(a,b.f)}}else{if(a.ai){e.aA(a,b)}}}if(a.T!=null){a.aN=false;if((a.T(a,b))){R=b.I;L=b.J;continue}else{if(a.aN){if(e.ag(a,b)){continue}}}}}if(a.E){A=e.ab[b.r]}else{A=e.m[b.r]}if(!a.aj){if(A!=e.aX){continue}}if(A!=undefined){if(Array.isArray(A)){al=false;aF=A.length;for(let at=0;at<aF;at++){if(A[at](a,b)){al=true;R=b.I;L=b.J;break}}if(al){continue}}else{if(A(a,b)){R=b.I;L=b.J;continue}}}a.T=null;if(a.E){b.d=b.d.replace(/\t/g,e.aZ);if(L<=b.J){a.ae+=b.d.slice(L,b.d.length)+"\n"}else{a.ae+=b.d+"\n"}}else{if(b.r==13){if(a.ae!=""){if(!a.G&&(b.f<a.h||(b.f==0))){e.j(a)}else{a.l+="<p>";e.j(a,"</p>\n")}}}else{if(R!=b.I){if(a.ae!=""){a.l+="<p>";e.j(a,"</p>\n")}a.ae+=b.d+" ";R=b.I;L=b.J}else{if(b.H==0){a.ae+=b.d+" "}else{if(b.H>0){a.ae+=b.d.substring(0,b.d.length-b.H)+"<br>"}else{a.ae+=b.d.substring(0,b.d.length-+b.H)+" "}}}}}}b.x=0;b.f=0;b.J=0;b.I=0;b.d="";e.aA(a,b);e.j(a,"");e.Z(a,0);if(a.mOptions.Timing){let bq=performance.now();let br=bq-aE;console.log("[Markdown] ","Parse Markdown: ",br,"ms")}return e.bD(a,a.l)};