// Renan LAVAREC - Ti-R - MIT License
if(TR==undefined){var TR={}}TR.MarkdownFSGlobal=new function(){let a=this;a.Debug=false;a.bR=function(){if(a.Debug){console.log("[Markdown] ",arguments)}};a.bb="    ";const J="<blockquote>";const y="</blockquote>\n";const R=/(\S*)\s?(\S*)/g;const K=/[<>`&]/g;a.bD=/!\[(.*?)\]\((.*?)\)/g;a.bC=/\[(.*)\](.*)/g;a.aU=/<?(https|http|ftp):\/\/([^\s<)]*?)($|[>\s<])/g;const U=/^\s*\|(.*)\|\s*$/;const h=/^(\s*)[-*+](\s+)(.*)/;const j=/^(\s*)(\d+)[\.\)](\s+)(.*)/;const D="";const C={"<":"&lt;",">":"&gt;","&":"&amp;","*":"&#42;",_:"&#95;","-":"&#45;","`":"&#96;"};a.aA=function X(q){return q.replace(K,function(Y){return C[Y]})};const H={c:"&copy;",C:"&copy;",r:"&reg;",R:"&reg;",p:"&sect;",P:"&sect;",tm:"&trade;",TM:"&trade;"};let L=0;a.bd=function(q){q.y=q.d.length;q.f=0;q.K=0;q.J=0;if(q.y!=0){q.I=0;if(q.y>2){if((q.d[q.y-2]=="\\")&&(q.d[q.y-3]!="\\")){q.I=2}if((q.d[q.y-2]==" ")&&(q.d[q.y-3]==" ")){q.I=3}if((q.d[q.y-2]=="\\")&&(q.d[q.y-3]=="\\")){q.I=-1}}for(let t=0;t<q.y;t++){q.r=q.d.charCodeAt(t);L=a.ab[q.r];if(L!=undefined){q.f+=L;if(L>0){++q.K}if(L==0){if(q.f>0){q.J=((q.f/4)|0)+1}q.ag=t;return}}else{q.ag=t;return}}q.ag=0;q.r=0;L=0}else{q.ag=0;q.r=13}};a.bH=function s(q,Z){Z=Z.replace(/\`+(.*?)\`+/g,function(ab,aa){q.aS.push("<code>"+a.aA(aa)+"</code>");return"¤cod¤"});Z=Z.replace(/\\([<_*-])/g,function(ab,aa){return C[aa]});Z=Z.replace(/\s<\s/g,function(){return C["<"]});Z=Z.replace(/<(*.?)>/g,function(ab,aa){console.log("html");return""});Z=Z.replace(/\`{4}(.*?)\`{4}/g,function(ab,aa){return"<code>"+a.aA(aa)+"</code>"});function Y(aa){let k={};let aE="";k.Z="";k.W="";if(aa&&aa.length>2){try{aa=aa.replaceAll(";}","}").replaceAll(";",'","').replaceAll(":",'":"').replaceAll("{",'{"').replaceAll("}",'"}');tObject=JSON.parse(aa);if(typeof tObject["text-align"]!="undefined"){aE=";text-align:"+tObject["text-align"];k.W='style="display:inline-block;width:100%'+aE+'"';delete tObject["text-align"]}aa=JSON.stringify(tObject).replaceAll(",",";").replaceAll('"',"");k.Z=' style="'+aa.substring(1,aa.length-1)+'"'}catch(ab){console.log("Parsing css to javascript object failed",aa)}}return k}Z=Z.replace(/!(.)?\[([^\[]*?)\]\((.*?)\)({(.*?)})?/g,function(ai,ag,ab,ah,aa){ah=ah.replace(R,function(ak,al,aj){return al});const ac=Y(aa);if(ag==undefined){if(ac.W!=""){q.aq.push("<span "+ac.W+'><img src="'+ah+'" alt="'+ab+'"'+ac.Z+"></span>")}else{q.aq.push('<img src="'+ah+'" alt="'+ab+'"'+ac.Z+">")}return"¤img¤"}else{if(ag=="v"){if(ab==D){ab="Your browser does not support the HTML5 Video element."}q.aQ.push("<span "+ac.W+'><video controls="controls" src="'+ah+'"'+ac.Z+">"+ab+"</video></span>");return"¤vid¤"}else{if(ag=="f"){if(q.s.by){q.ar.push("<span "+ac.W+'><iframe type="text/html" title="'+ab+'"'+ac.Z+' src="'+ah+'?enablejsapi=1" frameborder="0" allowfullscreen sandbox="allow-scripts allow-same-origin allow-presentation"></iframe></span>')}else{q.ar.push("")}return"¤ifr¤"}}}});Z=Z.replace(/\[([^\[]*?)\]\((.*?)\)/g,function(ac,aa,ab){let w=D;if(ab&&ab.length){if(ab[0]!="#"){w=' rel="nofollow"'}let x=ab.search(/\s/);if(x!=-1){tIndex=x+1+ab.substring(x+1).search(/\S/);const ah=ab[tIndex];if(ah!=")"){if(ah=='"'||ah=="'"){const ag=tIndex+1+ab.substring(tIndex+1).search(/["']/);w+=" title="+ab.substring(tIndex+1,ag)}else{w+=' title="'+ab.substring(tIndex,ab.length)+'"'}}ab=ab.substring(0,x)}}q.aR.push('<a href="'+ab+'"'+w+">"+aa+"</a>");return"¤url¤"});Z=Z.replace(a.aU,function(ag,aa,ac,ab){let aD=aa+"://"+ac;if(ab==">"){ab=D}let w=D;if(ac&&ac.length&&ac[0]!="#"){w=' rel="nofollow"'}return'<a href="'+aD+'"'+w+">"+aD+" </a>"+ab});Z=Z.replace(/[_\*][_\*](.*?)[_\*][_\*]/g,function(ab,aa){return"<strong>"+aa+"</strong>"});Z=Z.replace(/[_\*](.*?)[_\*]/g,function(ab,aa){return"<em>"+aa+"</em>"});Z=Z.replace(/\~~(.*?)\~~/g,function(ab,aa){return"<del>"+aa+"</del>"});Z=Z.replace(/\(([cCrRpP]|tm|TM)\)/g,function(ab,aa){return H[aa]});Z=Z.replace(/\+-/g,function(){return"&plusmn;"});Z=Z.replace(/(->|<-|---|--)/g,function(ab,aa){if(aa=="<-"){return"&larr;"}else{if(aa=="->"){return"&rarr;"}else{if(aa.length==3){return"&mdash;"}else{return"&ndash;"}}}});Z=Z.replace(/\[([x| ])\]/g,function(ab,aa){let aL="checked ";if(aa==" "){aL=D}return'<input type="checkbox" '+aL+"disabled>"});Z=Z.replace(/(!?)\[(.*?)\]\s?\[(.*?)\]/g,function(ac,aa,ag,ab){if(ab.length==0){ab=ag}ab=ab.toLowerCase();if(q.X[ab]==undefined){return aa+"["+ag+"]["+ab+"]"}let T=q.X[ab];if(aa=="!"){return'<img src="'+T.bw+'" alt="'+T.title+'">'}let w=D;let g=T.bw;if(T.title!=D){w+=' title="'+T.title+'"'}return'<a href="'+g+'"'+w+">"+ag+"</a>"});Z=Z.replaceAll("\n","");let br=0;let bo=0;let bn=0;let p=0;let n=Z.indexOf("¤");let o="";while(n>-1){let G=Z.substring(n+1,n+4);o+=Z.substring(p,n);p=n;if(G=="cod"){o+=q.aS[br++];p+=5}else{if(G=="pre"){o+=q.as[bo++];p+=5}else{if(G=="url"){o+=q.aR[bn++];p+=5}}}n=Z.indexOf("¤",n+5)}o+=Z.substring(p,Z.length);Z=o;let bp=0;let bm=0;let bq=0;p=0;n=Z.indexOf("¤");o="";while(n>-1){let G=Z.substring(n+1,n+4);o+=Z.substring(p,n);p=n;if(G=="img"){o+=q.aq[bp++];p+=5}else{if(G=="vid"){o+=q.aQ[bm++];p+=5}else{if(G=="ifr"){o+=q.ar[bq++];p+=5}}}n=Z.indexOf("¤",n+5)}o+=Z.substring(p,Z.length);Z=o;return Z};a.bM=function(q){if(q.C>0){do{if(q.af!=""){q.l+="<p>";a.j(q,"</p>"+y)}else{a.j(q,y)}}while(--q.C>0)}};a.bg=function P(q){if(q.v){q.v=0;a.j(q,"</tbody></table>",false)}};a.j=function m(q,Z,Y){q.l+=q.af;if(Z!=undefined){q.l+=Z}q.af=""};a.bN=function(q,Y){if(q.F){q.af+="\n"}};a.bh=function v(q,Y){let N=0;do{let c=(/^\s*\>\s*(.*)/).exec(Y.d);if(c==null){break}else{Y.d=c[1];++N}}while(1);if(N>0){q.aj=true;if((N-q.C)>0){for(;q.C<N;++q.C){a.j(q,J)}}else{if((q.C-N)>0){for(;q.C>N;--q.C){a.j(q,y)}}}a.bd(Y);q.aO=true;return false}if(q.aj){a.aB(q,Y)}};a.aB=function u(q,Y){a.be(q,Y);a.bM(q)};a.ai=function A(q,Y){if(Y.d!=D){let c=(/(```|~~~)(.*)/).exec(Y.d);if(c!=null){if(!q.F){q.F=true;a.j(q);q.aJ=c[2]}else{q.F=false;q.af=q.s.bf.call(a,q.af,q.aJ);q.as.push(q.af);q.af="¤pre¤\n";a.j(q)}return true}}return false};a.ah=function I(q,Y){if((Y.f-q.h)>=4){let bk=q.h+4;Y.d=Y.d.replace(/\t/g,a.bb);if(!q.R){q.R=true;a.j(q)}q.af+=Y.d.slice(bk,Y.d.length)+"\n";return true}a.be(q,Y);return false};a.be=function W(q,Y){if(q.R){q.R=false;q.af=q.s.bf.call(a,q.af,D);q.as.push(q.af);q.af="¤pre¤\n";a.j(q)}};a.aX=function E(q,Y){let c=(/^[=-]{3}[=-]+/).test(Y.d);if(c){if(Y.d[0]=="="){q.l+="<H1>";a.j(q,"</H1>\n")}else{if(Y.d[0]=="-"){q.l+="<H2>";a.j(q,"</H2>\n")}}return true}return false};a.aY=function l(q,Y){let c=(/^\s*(#+)\s+([^#]*)(#*)/).exec(Y.d);if(c!=null){c[2]=c[2].trim();if(!q.H&&(Y.f<q.h||(Y.f==0))){a.aa(q,Y.f)}let bs=c[1].length;let ad={};ad.bc=true;let bv=q.s.bL.call(q,bs,c[2],ad);q.ak=ad.bc;if(ad.bc==true){a.j(q,bv);q.bj=true}else{}return true}return false};a.ba=function d(q,Y){let c=U.exec(Y.d);if(c!=null){if(q.v==0){a.j(q,"<table><thead><tr>")}else{a.j(q,"<tr>")}let aK=false;let aM=c[1].split("|");for(let z=0;z<aM.length;z++){let O=aM[z];O=O.trim();if(q.v==0){q.l+="<th>";q.af+=O;a.j(q,"</th>")}else{if(q.v==1){O.replace(/^(:*)-+(:*)$/,function(ab,aa,Z){if(aa!=""){if(Z!=""){q.E[z]=0}else{q.E[z]=1}}else{if(Z!=""){q.E[z]=2}else{q.E[z]=3}}aK=true});if(aK){continue}}let k="";if(q.E[z]==0){k=' style="text-align:center;"'}else{if(q.E[z]==1){k=' style="text-align:left;"'}else{if(q.E[z]==2){k=' style="text-align:right;"'}}}q.l+="<td"+k+">";q.af+=O;a.j(q,"</td>")}}if(q.v==0){q.l+="</tr></thead><tbody>";q.v=1}else{q.v=2;a.j(q,"</tr>")}q.U=a.ba;return true}a.bg(q);return false};a.bg=function P(q){if(q.v>0){q.v=0;a.j(q,"</tbody></table>",false)}};a.ax=function(q,Y){let c=h.exec(Y.d);if(c!=null){return true}return false};a.ay=function Q(q,Y){let c=h.exec(Y.d);if(c!=null){q.H=false;Y.f-=1;Y.f+=c[2].length;let V=false;if(Y.f>q.h){q.h=Y.f;if((q.h+1)>q.Y){q.Y=q.h+1}}else{if(Y.f<q.h){V=true;q.h=Y.f}}if(q.u[q.h]&2048||V){a.aa(q,Y.f)}if(q.u[q.h]==0){q.u[q.h]=32768;q.l+="<ul>\n"}else{q.af+="</li>\n";a.j(q)}q.l+="<li>\n";q.l+=c[3];return true}return false};a.bI=function(q,Y){let c=j.exec(Y.d);if(c!=null){return true}return false};a.bJ=function f(q,Y){let c=j.exec(Y.d);if(c!=null){q.H=false;let V=false;Y.f+=c[2].length;Y.f-=1;Y.f+=c[3].length;if(Y.f>q.h){q.h=Y.f;if((q.h+1)>q.Y){q.Y=q.h+1}}else{if(Y.f<q.h){V=true;q.h=Y.f}}if(q.u[q.h]&32768||V){a.aa(q,Y.h)}if(q.u[q.h]==0){q.u[q.h]=2048;q.l+="<ol start="+c[2]+">\n"}else{q.af+="</li>\n";a.j(q)}q.l+="<li>\n";q.af+=c[4];return true}return false};a.aa=function r(q,Y){if(!q.H){let ae=q.Y;while(ae-->Y){if(q.u[ae]!=0){if(q.u[ae]&2048){a.j(q,"</li>\n</ol>\n")}else{a.j(q,"</li>\n</ul>\n")}q.u[ae]=0}}if(Y==0){q.H=true;q.h=0}}};a.bK=function F(Y,Z){let c=(/\[(.*?)\]:\s+(.*)/).exec(Z.d);if(c!=null){if(c.length>2){const q=c[2];let x=q.search(/\s/);if(x!=-1){tIndex=x+1+q.substring(x+1).search(/\S/);const ab=q[tIndex];if(ab!=")"){if(ab=='"'||ab=="'"||ab=="("){const aa=tIndex+1+q.substring(tIndex+1).search(/["')]/);Y.X[c[1].toLowerCase()]={link:q.substring(0,x),title:q.substring(tIndex+1,aa)}}else{Y.X[c[1].toLowerCase()]={link:q.substring(0,x),title:q.substring(tIndex,q.length)}}return true}}}Y.X[c[1].toLowerCase()]={link:c[2],title:D};tConvertURL=false;return true}return false};a.az=function(q,Y){let c=(/^[\*-]\s[\*-]\s[\*-]/).exec(Y.d);if(c!=null){q.l+="<hr>";return true}c=(/^[\*_-]{3}/).exec(Y.d);if(c!=null){q.l+="<hr>";return true}return false};a.Q=256;a.ab=new Array(a.Q);a.m=new Array(a.Q);a.ac=new Array(a.Q);a.P=new Array(a.Q);for(let t=a.Q;t--;){a.ab[t]=0;a.m[t]=undefined;a.ac[t]=undefined;a.P[t]=undefined}function i(q){return q.charCodeAt(0)}a.aN=i(" ");a.an=i("*");a.ap=i("-");a.ao=i("+");a.aC=i("0");a.aP=i("9");a.ab[i("\t")]=4;a.ab[i(" ")]=1;a.m[13]=a.bN;a.m[i("=")]=a.aX;a.m[a.ap]=[a.az,a.aX,a.ay];a.m[i("_")]=a.az;a.ac[i("~")]=a.ai;a.ac[i("`")]=a.ai;a.m[i("~")]=a.ai;a.m[i("`")]=a.ai;a.m[a.aN]=a.ah;a.m[i("#")]=a.aY;a.bi=i(">");a.m[a.bi]=a.bh;a.m[i("|")]=a.ba;a.m[a.an]=[a.az,a.ay];a.m[a.ao]=a.ay;a.P[a.an]=a.ax;a.P[a.ao]=a.ax;a.P[a.ap]=a.ax;let bx=a.aP;for(let af=a.aC;af<=bx;af++){a.P[af]=a.bI;a.m[af]=a.bJ}a.m[i("[")]=a.bK};TR.MarkdownFS=function(d){let a=this;a.s={};a.s.aZ=false;a.s.by=true;a.s.bf=function(f,h){return"<pre>"+TR.MarkdownFSGlobal.aA(f)+"</pre>"};a.s.bL=function(h,i,f){return"<H"+h+this.bG(i)+">"+i+"</H"+h+">\n"};a.aI=100;a.Y=2;a.u=new Array(a.aI);if(d){let a=this;for(let key in d){a.s[key]=d[key]}}};TR.MarkdownFS.prototype.bG=function(d){let e=TR.MarkdownFSGlobal;d=d.replace(e.bD,function(f,i,h){return e.q});d=d.replace(e.aU,function(){return e.q});if(d==e.q){return d}d=d.replace(e.bC,function(h,f){return f});d=d.replace(/\\</g,function(){return"<"});d=d.replace(/\s/g,"-");return' id="'+d.toLowerCase()+'"'};TR.MarkdownFS.prototype.toHtml=function(d){let a=this;a.F=false;a.R=false;a.ak=true;a.l="";a.U=null;a.bO=false;a.af="";a.aS=[];a.as=[];a.aR=[];a.aq=[];a.aQ=[];a.ar=[];a.H=true;for(let aT=a.aI;aT--;){a.u[aT]=0}a.aj=false;a.v=0;a.h=0;a.C=0;a.bj=false;a.E={};a.aJ="";a.X={};let aF;if(a.s.aZ){aF=performance.now()}let aH=d.split("\n");let e=TR.MarkdownFSGlobal;let aG=0;let bl=aH.length;let am=false;let b={};let S=0;let M=0;let B;let bQ;let bP=false;for(let at=0;at<bl;at++){b.d=aH[at];e.bd(b);if(a.ak){if(a.R){if(e.ah(a,b)){continue}}if(!a.F){if(b.r!=13){if(b.r==e.bi){a.U=e.bh}if(e.ah(a,b)){continue}if(b.r==e.an||b.r==e.ap||b.r==e.ao||(b.r>=e.aC&&b.r<=e.aP)){if(b.d.charCodeAt(b.ag+1)==e.aN){b.f+=2}}if(!a.H&&((b.f<a.h)&&(b.f!=(a.h-2))||(b.f==0))){e.aa(a,b.f)}}else{if(a.aj){e.aB(a,b)}}}if(a.U!=null){a.aO=false;if((a.U(a,b))){S=b.J;M=b.K;continue}else{if(a.aO){if(e.ah(a,b)){continue}}}}}if(a.F){B=e.ac[b.r]}else{B=e.m[b.r]}if(!a.ak){if(B!=e.aY){continue}}if(B!=undefined){if(Array.isArray(B)){am=false;aG=B.length;for(let au=0;au<aG;au++){if(B[au](a,b)){am=true;S=b.J;M=b.K;break}}if(am){continue}}else{if(B(a,b)){S=b.J;M=b.K;continue}}}a.U=null;if(a.F){b.d=b.d.replace(/\t/g,e.bb);if(M<=b.K){a.af+=b.d.slice(M,b.d.length)+"\n"}else{a.af+=b.d+"\n"}}else{if(b.r==13){if(a.af!=""){if(!a.H&&(b.f<a.h||(b.f==0))){e.j(a)}else{a.l+="<p>";e.j(a,"</p>\n")}}}else{if(S!=b.J){if(a.af!=""){a.l+="<p>";e.j(a,"</p>\n")}a.af+=b.d+" ";S=b.J;M=b.K}else{if(b.I==0){a.af+=b.d+" "}else{if(b.I>0){a.af+=b.d.substring(0,b.d.length-b.I)+"<br>"}else{a.af+=b.d.substring(0,b.d.length-+b.I)+" "}}}}}}b.y=0;b.f=0;b.K=0;b.J=0;b.d="";e.aB(a,b);e.j(a,"");e.aa(a,0);if(a.s.aZ){let bt=performance.now();let bu=bt-aF;console.log("[Markdown] ","Parse Markdown: ",bu,"ms")}return e.bH(a,a.l)};